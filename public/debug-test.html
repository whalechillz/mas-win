<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASGOLF Slack ì•Œë¦¼ ë””ë²„ê¹…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">ğŸ”§ MASGOLF Slack ì•Œë¦¼ ë””ë²„ê¹…</h1>
        
        <!-- ì„¤ì • í™•ì¸ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“‹ í˜„ì¬ ì„¤ì •</h2>
            <div id="configStatus" class="space-y-2">
                <p class="text-gray-600">ì„¤ì •ì„ í™•ì¸í•˜ëŠ” ì¤‘...</p>
            </div>
        </div>

        <!-- API í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸš€ API í…ŒìŠ¤íŠ¸</h2>
            <button onclick="testSlackAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                /api/slack-test ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
            </button>
            <div id="apiResult" class="mt-4 p-4 bg-gray-100 rounded hidden">
                <pre class="text-sm"></pre>
            </div>
        </div>

        <!-- ì˜ˆì•½ ì•Œë¦¼ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“… ì˜ˆì•½ ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h2>
            <form id="bookingTestForm" class="space-y-4">
                <input type="text" name="name" placeholder="ì´ë¦„" value="í…ŒìŠ¤íŠ¸ ê³ ê°" 
                       class="w-full p-2 border rounded">
                <input type="tel" name="phone" placeholder="ì „í™”ë²ˆí˜¸" value="010-1234-5678" 
                       class="w-full p-2 border rounded">
                <input type="date" name="date" value="2025-07-15" 
                       class="w-full p-2 border rounded">
                <select name="time" class="w-full p-2 border rounded">
                    <option value="14:00">ì˜¤í›„ 2ì‹œ</option>
                    <option value="15:00">ì˜¤í›„ 3ì‹œ</option>
                </select>
                <select name="club" class="w-full p-2 border rounded">
                    <option value="ì‹œí¬ë¦¬íŠ¸í¬ìŠ¤ PRO 3">ì‹œí¬ë¦¬íŠ¸í¬ìŠ¤ PRO 3</option>
                    <option value="ì‹œí¬ë¦¬íŠ¸ì›¨í° ë¸”ë™">ì‹œí¬ë¦¬íŠ¸ì›¨í° ë¸”ë™</option>
                </select>
                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    ì˜ˆì•½ ì•Œë¦¼ ë³´ë‚´ê¸°
                </button>
            </form>
            <div id="bookingResult" class="mt-4 p-4 bg-gray-100 rounded hidden">
                <pre class="text-sm"></pre>
            </div>
        </div>

        <!-- ë¬¸ì˜ ì•Œë¦¼ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ’¬ ë¬¸ì˜ ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h2>
            <form id="contactTestForm" class="space-y-4">
                <input type="text" name="name" placeholder="ì´ë¦„" value="ë¬¸ì˜ ê³ ê°" 
                       class="w-full p-2 border rounded">
                <input type="tel" name="phone" placeholder="ì „í™”ë²ˆí˜¸" value="010-9876-5432" 
                       class="w-full p-2 border rounded">
                <input type="text" name="call_times" placeholder="í†µí™” ê°€ëŠ¥ ì‹œê°„" value="ì˜¤ì „ 10ì‹œ, ì˜¤í›„ 2ì‹œ" 
                       class="w-full p-2 border rounded">
                <button type="submit" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ë¬¸ì˜ ì•Œë¦¼ ë³´ë‚´ê¸°
                </button>
            </form>
            <div id="contactResult" class="mt-4 p-4 bg-gray-100 rounded hidden">
                <pre class="text-sm"></pre>
            </div>
        </div>

        <!-- ì§ì ‘ ì›¹í›… í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ”— ì§ì ‘ ì›¹í›… í…ŒìŠ¤íŠ¸ (í´ë¼ì´ì–¸íŠ¸)</h2>
            <p class="text-sm text-red-500 mb-4">âš ï¸ ì£¼ì˜: ì´ ë°©ë²•ì€ CORS ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <button onclick="testDirectWebhook()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ ì›¹í›… í˜¸ì¶œ
            </button>
            <div id="directResult" class="mt-4 p-4 bg-gray-100 rounded hidden">
                <pre class="text-sm"></pre>
            </div>
        </div>

        <!-- ë¡œê·¸ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“ ë””ë²„ê·¸ ë¡œê·¸</h2>
            <div id="debugLog" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm overflow-auto max-h-96">
                <p>ëŒ€ê¸° ì¤‘...</p>
            </div>
            <button onclick="clearLog()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                ë¡œê·¸ ì§€ìš°ê¸°
            </button>
        </div>
    </div>

    <script>
        let logContent = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const color = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-gray-400';
            logContent.push(`<span class="${color}">[${timestamp}] ${message}</span>`);
            document.getElementById('debugLog').innerHTML = logContent.join('<br>');
            document.getElementById('debugLog').scrollTop = document.getElementById('debugLog').scrollHeight;
        }
        
        function clearLog() {
            logContent = [];
            document.getElementById('debugLog').innerHTML = '<p>ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</p>';
        }
        
        // ì„¤ì • í™•ì¸
        window.onload = function() {
            const configStatus = document.getElementById('configStatus');
            let html = '';
            
            if (typeof SUPABASE_CONFIG !== 'undefined') {
                html += '<p class="text-green-600">âœ… SUPABASE_CONFIG ë¡œë“œë¨</p>';
                html += `<p class="text-gray-600 ml-4">- URL: ${SUPABASE_CONFIG.url.substring(0, 30)}...</p>`;
                html += `<p class="text-gray-600 ml-4">- Anon Key: ${SUPABASE_CONFIG.anonKey.substring(0, 30)}...</p>`;
                
                if (SUPABASE_CONFIG.slackWebhook && SUPABASE_CONFIG.slackWebhook !== 'YOUR_SLACK_WEBHOOK_URL_FOR_01-ma-op') {
                    html += '<p class="text-green-600">âœ… Slack Webhook ì„¤ì •ë¨</p>';
                    html += `<p class="text-gray-600 ml-4">- Webhook: ${SUPABASE_CONFIG.slackWebhook.substring(0, 50)}...</p>`;
                } else {
                    html += '<p class="text-red-600">âŒ Slack Webhook ì„¤ì • ì•ˆ ë¨</p>';
                }
            } else {
                html += '<p class="text-red-600">âŒ SUPABASE_CONFIGë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ</p>';
            }
            
            configStatus.innerHTML = html;
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        };
        
        // API í…ŒìŠ¤íŠ¸
        async function testSlackAPI() {
            log('API í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            const resultDiv = document.getElementById('apiResult');
            resultDiv.classList.remove('hidden');
            resultDiv.querySelector('pre').textContent = 'ìš”ì²­ ì¤‘...';
            
            try {
                const response = await fetch('/api/slack-test');
                const data = await response.json();
                
                resultDiv.querySelector('pre').textContent = JSON.stringify(data, null, 2);
                
                if (data.success) {
                    log('API í…ŒìŠ¤íŠ¸ ì„±ê³µ!', 'success');
                } else {
                    log(`API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${data.error}`, 'error');
                }
            } catch (error) {
                resultDiv.querySelector('pre').textContent = `Error: ${error.message}`;
                log(`API í…ŒìŠ¤íŠ¸ ì—ëŸ¬: ${error.message}`, 'error');
            }
        }
        
        // ì˜ˆì•½ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
        document.getElementById('bookingTestForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            log('ì˜ˆì•½ ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            const resultDiv = document.getElementById('bookingResult');
            resultDiv.classList.remove('hidden');
            resultDiv.querySelector('pre').textContent = 'ìš”ì²­ ì¤‘...';
            
            try {
                const response = await fetch('/api/slack/notify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'booking',
                        data: data
                    })
                });
                
                const result = await response.json();
                resultDiv.querySelector('pre').textContent = JSON.stringify(result, null, 2);
                
                if (result.success) {
                    log('ì˜ˆì•½ ì•Œë¦¼ ì „ì†¡ ì„±ê³µ!', 'success');
                } else {
                    log(`ì˜ˆì•½ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                resultDiv.querySelector('pre').textContent = `Error: ${error.message}`;
                log(`ì˜ˆì•½ ì•Œë¦¼ ì—ëŸ¬: ${error.message}`, 'error');
            }
        });
        
        // ë¬¸ì˜ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
        document.getElementById('contactTestForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            log('ë¬¸ì˜ ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            const resultDiv = document.getElementById('contactResult');
            resultDiv.classList.remove('hidden');
            resultDiv.querySelector('pre').textContent = 'ìš”ì²­ ì¤‘...';
            
            try {
                const response = await fetch('/api/slack/notify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'contact',
                        data: data
                    })
                });
                
                const result = await response.json();
                resultDiv.querySelector('pre').textContent = JSON.stringify(result, null, 2);
                
                if (result.success) {
                    log('ë¬¸ì˜ ì•Œë¦¼ ì „ì†¡ ì„±ê³µ!', 'success');
                } else {
                    log(`ë¬¸ì˜ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                resultDiv.querySelector('pre').textContent = `Error: ${error.message}`;
                log(`ë¬¸ì˜ ì•Œë¦¼ ì—ëŸ¬: ${error.message}`, 'error');
            }
        });
        
        // ì§ì ‘ ì›¹í›… í…ŒìŠ¤íŠ¸
        async function testDirectWebhook() {
            log('ì§ì ‘ ì›¹í›… í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            const resultDiv = document.getElementById('directResult');
            resultDiv.classList.remove('hidden');
            resultDiv.querySelector('pre').textContent = 'ìš”ì²­ ì¤‘...';
            
            if (!SUPABASE_CONFIG || !SUPABASE_CONFIG.slackWebhook || 
                SUPABASE_CONFIG.slackWebhook === 'YOUR_SLACK_WEBHOOK_URL_FOR_01-ma-op') {
                resultDiv.querySelector('pre').textContent = 'Error: Slack Webhook URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                log('Slack Webhook URLì´ ì„¤ì •ë˜ì§€ ì•ŠìŒ', 'error');
                return;
            }
            
            try {
                log(`ì›¹í›… URL: ${SUPABASE_CONFIG.slackWebhook.substring(0, 50)}...`);
                
                const response = await fetch(SUPABASE_CONFIG.slackWebhook, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: 'ğŸ§ª ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ ë³´ë‚¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤!'
                    })
                });
                
                const result = await response.text();
                resultDiv.querySelector('pre').textContent = `Status: ${response.status}\nResponse: ${result}`;
                
                if (response.ok) {
                    log('ì§ì ‘ ì›¹í›… í…ŒìŠ¤íŠ¸ ì„±ê³µ!', 'success');
                } else {
                    log(`ì§ì ‘ ì›¹í›… í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${response.status}`, 'error');
                }
            } catch (error) {
                resultDiv.querySelector('pre').textContent = `Error: ${error.message}\n\nì£¼ì˜: CORS ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ë©´ ì„œë²„ APIë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.`;
                log(`ì§ì ‘ ì›¹í›… ì—ëŸ¬: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>