# Phase 6: 마이그레이션 검증 및 개선 계획

## 📋 문서 정보
- **작성일**: 2025-11-26
- **상태**: 검증 진행 중

---

## 🔍 검증 항목

### 1. 데이터베이스 업데이트 안된 명단 확인

#### 검증 방법
- CSV 파일의 전화번호와 DB의 전화번호 비교
- CSV에 있지만 DB에 없는 전화번호 목록 추출
- 검증 스크립트: `scripts/validate-migration.js`

#### 확인 사항
- 전화번호 정규화 실패한 경우
- 마이그레이션 중 오류가 발생한 경우
- 중복 제거로 인한 누락

---

### 2. 리스트에 사용클럽, 거리 등 정보 표시

#### 현재 상황
- **DB에는 저장됨**: `club_brand`, `club_loft`, `club_shaft`, `current_distance`, `age_group`, `trajectory`, `shot_shape`
- **UI에는 표시 안됨**: 현재 `BookingListView`에는 `club` 필드만 표시됨

#### 개선 계획
1. **관리자 페이지 테이블에 컬럼 추가**:
   - 사용 클럽 (브랜드, 로프트, 샤프트)
   - 현재 비거리
   - 연령대
   - 탄도/구질 (선택적)

2. **표시 형식**:
   ```
   클럽: 브랜드 (로프트° 샤프트)
   예: "젝시오 (10.5° S)"
   거리: "200m"
   연령대: "40대"
   ```

3. **수정 파일**:
   - `components/admin/bookings/BookingListView.tsx`
   - 테이블 헤더에 컬럼 추가
   - 테이블 바디에 데이터 표시

---

### 3. 노쇼일 경우 처리 및 취소 기준

#### 현재 구조
- **`attendance_status`**: 참석 여부
  - `attended`: 참석
  - `no_show`: 노쇼
  - `cancelled`: 취소
  - `pending`: 대기중

- **`status`**: 예약 상태
  - `confirmed`: 확정
  - `pending`: 대기중
  - `cancelled`: 취소
  - `completed`: 완료

#### 구분 기준
1. **`status` (예약 상태)**:
   - 예약이 확정되었는지, 취소되었는지
   - 예약 전 단계의 상태

2. **`attendance_status` (참석 여부)**:
   - 예약일 당일 실제 참석 여부
   - 예약 후 단계의 상태

#### 처리 로직
- **노쇼 (`attendance_status = 'no_show'`)**:
  - 예약은 확정되었지만(`status = 'confirmed'`)
  - 실제로는 방문하지 않음(`attendance_status = 'no_show'`)
  - 고객의 `no_show_count` 증가

- **취소 (`status = 'cancelled'`)**:
  - 예약 전에 취소됨
  - `attendance_status`는 `cancelled` 또는 `pending`

#### UI 개선 계획
1. **상태 표시 개선**:
   - `status`와 `attendance_status`를 모두 표시
   - 노쇼인 경우 명확히 표시

2. **필터 추가**:
   - 노쇼 필터
   - 취소 필터
   - 참석 필터

---

### 4. 여러 번 방문 시 데이터 구조

#### 현재 구조
- **여러 줄로 저장됨**: 각 예약마다 별도의 `bookings` 레코드
- **고객 정보는 통합**: `customers` 테이블에 `visit_count`, `no_show_count`, `last_visit_date` 저장

#### 장점
- 각 예약의 상세 정보 보존
- 예약별 클럽 정보, 거리 등 개별 저장 가능
- 방문 이력 추적 용이

#### 개선 계획
1. **고객별 그룹화 뷰 추가**:
   - 고객명 클릭 시 해당 고객의 모든 예약 표시
   - 방문 횟수 표시

2. **통계 표시**:
   - 고객별 총 방문 횟수
   - 고객별 노쇼 횟수
   - 고객별 마지막 방문일

3. **필터 개선**:
   - 재방문 고객 필터
   - 신규 고객 필터

---

## 📊 데이터베이스 검증 계획

### 검증 스크립트
- **파일**: `scripts/validate-migration.js`
- **기능**:
  1. CSV와 DB 데이터 비교
  2. 누락된 전화번호 확인
  3. 데이터 품질 통계
  4. 여러 번 방문 고객 확인
  5. 클럽 정보 누락 예약 확인

### 검증 항목
1. **데이터 완전성**:
   - CSV의 모든 전화번호가 DB에 있는지
   - 모든 예약이 저장되었는지

2. **데이터 품질**:
   - 클럽 정보 채움률
   - 거리 정보 채움률
   - 이메일 정보 채움률

3. **데이터 일관성**:
   - 전화번호 정규화 확인
   - 날짜/시간 형식 확인
   - 상태 값 확인

4. **비즈니스 로직**:
   - 여러 번 방문 고객 확인
   - 노쇼/취소 비율 확인
   - 방문 패턴 분석

### 검증 결과 보고서
- **저장 위치**: `backup/validation-report-{timestamp}.json`
- **포함 내용**:
  - 누락된 전화번호 목록
  - 데이터 품질 통계
  - 여러 번 방문 고객 목록
  - 클럽 정보 없는 예약 목록

---

## ✅ 개선 작업 목록

### 우선순위 1: 즉시 수정
- [ ] 검증 스크립트 실행 및 누락 데이터 확인
- [ ] 관리자 페이지에 클럽 정보 컬럼 추가
- [ ] 관리자 페이지에 거리, 연령대 컬럼 추가

### 우선순위 2: 단기 개선
- [ ] `attendance_status`와 `status` 구분 명확화
- [ ] 노쇼/취소 필터 추가
- [ ] 고객별 그룹화 뷰 추가

### 우선순위 3: 장기 개선
- [ ] 방문 패턴 분석 대시보드
- [ ] 고객별 예약 이력 상세 뷰
- [ ] 데이터 품질 개선 자동화

---

## 🔄 업데이트 이력
- **2025-11-26**: 검증 계획 수립 및 검증 스크립트 작성




