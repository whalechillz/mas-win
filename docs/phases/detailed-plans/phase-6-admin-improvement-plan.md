# Phase 6: 관리자 페이지 개선 계획

## 📋 문서 정보
- **작성일**: 2025-11-26
- **상태**: 구현 진행 중
- **우선순위**: 높음

---

## 🎯 개선 목표

1. **의미있는 통계 데이터 표시**: 최다 방문자, 노쇼율, 재방문율 등
2. **필터 기능 강화**: 노쇼/취소 필터, 고객별 그룹화
3. **데이터 차이 분석**: CSV 1,247건 → DB 945건 차이 원인 파악

---

## 📊 1. 의미있는 통계 데이터 계획

### 1.1 최다 방문자 통계

#### 표시할 데이터
- **최다 방문 고객 TOP 10**
  - 고객명, 전화번호
  - 방문 횟수
  - 첫 방문일, 마지막 방문일
  - 노쇼 횟수
  - 평균 방문 간격

#### 구현 위치
- `components/admin/bookings/BookingDashboard.tsx`
- 새로운 섹션 추가: "VIP 고객" 또는 "최다 방문 고객"

#### 데이터 소스
- `customers` 테이블: `visit_count`, `no_show_count`, `last_visit_date`
- `bookings` 테이블: 각 고객의 예약 이력

### 1.2 노쇼율 통계

#### 표시할 데이터
- **전체 노쇼율**: 노쇼 건수 / 전체 예약 건수
- **월별 노쇼율**: 월별 노쇼 추이
- **노쇼율이 높은 고객**: 노쇼 비율이 높은 고객 목록
- **노쇼 패턴**: 요일별, 시간대별 노쇼율

#### 구현 위치
- `BookingDashboard.tsx`에 통계 카드 추가

#### 데이터 소스
- `bookings` 테이블: `attendance_status = 'no_show'`
- `customers` 테이블: `no_show_count`

### 1.3 재방문율 통계

#### 표시할 데이터
- **재방문율**: 재방문 고객 수 / 전체 고객 수
- **재방문 고객 수**: 2회 이상 방문한 고객 수
- **평균 방문 횟수**: 전체 고객의 평균 방문 횟수
- **신규 vs 재방문 비율**: 신규 고객 vs 재방문 고객

#### 구현 위치
- `BookingDashboard.tsx`에 통계 카드 추가

### 1.4 기타 의미있는 통계

#### 월별 예약 추이
- 월별 예약 건수 그래프
- 월별 참석률 그래프
- 월별 노쇼율 그래프

#### 서비스별 통계
- 서비스 타입별 예약 건수
- 서비스별 참석률
- 서비스별 노쇼율

#### 시간대별 통계
- 시간대별 예약 분포
- 시간대별 노쇼율

---

## 🔍 2. 노쇼/취소 필터

### 2.1 필터 위치
- `components/admin/bookings/BookingListView.tsx`
- 기존 필터 옆에 추가

### 2.2 필터 옵션

#### 참석 상태 필터
- 전체
- 참석 (`attendance_status = 'attended'`)
- 노쇼 (`attendance_status = 'no_show'`)
- 취소 (`attendance_status = 'cancelled'`)
- 대기중 (`attendance_status = 'pending'`)

#### 예약 상태 필터
- 전체
- 확정 (`status = 'confirmed'`)
- 대기중 (`status = 'pending'`)
- 취소 (`status = 'cancelled'`)
- 완료 (`status = 'completed'`)

#### 복합 필터
- 노쇼만 보기: `attendance_status = 'no_show'`
- 취소만 보기: `status = 'cancelled'`
- 참석 완료: `attendance_status = 'attended'` AND `status = 'completed'`

---

## 👥 3. 고객별 그룹화 뷰

### 3.1 뷰 구조

#### 고객 목록 뷰
- 고객명, 전화번호
- 방문 횟수
- 노쇼 횟수
- 마지막 방문일
- 평균 방문 간격

#### 고객 상세 뷰
- 고객 기본 정보
- 모든 예약 이력 (날짜순)
- 각 예약의 상세 정보 (클럽, 거리, 연령대 등)
- 방문 패턴 분석

### 3.2 구현 방법

#### 새로운 컴포넌트
- `components/admin/bookings/CustomerGroupedView.tsx`
- 고객별로 그룹화된 예약 목록 표시

---

## 🔍 4. CSV 1,247건 → DB 945건 차이 분석

### 4.1 차이 원인 분석

#### 가능한 원인
1. **전화번호 없는 행 제외** (약 302건)
   - 이름만 있는 예약은 제외됨

2. **예약 날짜/시간 없는 행 제외**
   - 예약 정보가 불완전한 행은 제외됨

3. **중복 예약 제거**
   - 같은 전화번호, 같은 날짜/시간의 예약은 업데이트만 함

4. **Supabase 쿼리 제한**
   - 기본적으로 1,000건 제한
   - 실제로는 945건 저장됨

### 4.2 누락된 데이터 확인

#### 확인 방법
1. **검증 스크립트 실행**
   ```bash
   node scripts/validate-migration.js
   ```

2. **CSV 파일 분석**
   - 전화번호 없는 행 수
   - 예약 날짜/시간 없는 행 수
   - 중복 예약 수

---

## 📋 최종 구현 계획

### Phase 1: 통계 데이터 추가 ✅ (우선순위 1) - 완료
- [x] 최다 방문자 TOP 10 표시
- [x] 노쇼율 통계 추가
- [x] 재방문율 통계 추가
- [x] 평균 방문 횟수 통계 추가
- [x] 참석 상태 통계 추가
- [ ] 월별 예약 추이 그래프 (추후)

### Phase 2: 필터 기능 강화 ✅ (우선순위 2) - 완료
- [x] 참석 상태 필터 추가 (attended, no_show, cancelled, pending)
- [x] 예약 상태 필터 개선
- [x] 복합 필터 기능 (예약 상태 + 참석 상태 동시 필터링)

### Phase 3: 고객별 그룹화 뷰 ✅ (우선순위 3) - 완료
- [x] 고객별 그룹화 뷰 컴포넌트 생성 (`CustomerGroupedView.tsx`)
- [x] 고객 상세 뷰 구현 (아코디언 형태로 예약 이력 표시)
- [x] 고객 검색 기능
- [x] 정렬 기능 (방문 횟수, 고객명, 마지막 방문일)
- [x] 관리자 페이지에 "고객별" 탭 추가

### Phase 4: 데이터 차이 분석 및 개선 ✅ (우선순위 4) - 완료
- [x] 누락 데이터 상세 분석 스크립트 작성 (`analyze-migration-difference.js`)
- [x] 데이터 차이 원인 분석 완료
  - 전화번호 없음: 302건
  - 예약 날짜/시간 없음: 0건
  - 중복 예약: 47건 (업데이트 처리)
- [x] 마이그레이션 스크립트 개선 (옵션 추가)
  - `--use-registration-date`: 예약 날짜/시간 없을 때 등록일 사용
  - `--verbose`: 상세 로그 출력

---

## 🔄 업데이트 이력
- **2025-11-26**: 관리자 페이지 개선 계획 수립
- **2025-11-26**: Phase 1, 2 구현 완료 (통계 데이터, 필터 기능)
- **2025-11-26**: Phase 3, 4 구현 완료 (고객별 그룹화 뷰, 데이터 차이 분석)
- **2025-11-26**: 전화번호 매칭 기능 구현 완료

