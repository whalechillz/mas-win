# ìƒ¤í”„íŠ¸ ë° ë°°ì§€ í•©ì„± ê°œì„  ê³„íš

## ğŸ“‹ í˜„ì¬ ë¬¸ì œì 

### 1. ì´ë¯¸ì§€ í•©ì„± ê²°ê³¼ê°€ ì›ë³¸ê³¼ ë‹¤ë¦„
- **ë¬¸ì œ**: ì´ë¯¸ì§€1,2ì™€ ê°™ì´ ë„£ì—ˆëŠ”ë° ì´ë¯¸ì§€3,4ì²˜ëŸ¼ êµ¬í˜„ë¨ (ì™„ì „íˆ ë˜‘ê°™ì§€ ì•ŠìŒ)
- **ì›ì¸**: 
  - ìƒ¤í”„íŠ¸ ìƒ‰ìƒì´ ëª…ì‹œë˜ì§€ ì•Šì•„ AIê°€ ì„ì˜ë¡œ ìƒ‰ìƒì„ ìƒì„±
  - ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ê°€ ì°¸ì¡° ì´ë¯¸ì§€ë¡œ ì œê³µë˜ì§€ ì•ŠìŒ
  - ë°°ì§€ ì´ë¯¸ì§€ê°€ ì°¸ì¡° ì´ë¯¸ì§€ë¡œ ì œê³µë˜ì§€ ì•ŠìŒ

### 2. ìƒ¤í”„íŠ¸ ìƒ‰ìƒ ë¬¸ì œ
- **ë¬¸ì œ**: ìƒ¤í”„íŠ¸ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ê²€ì •ìƒ‰ì´ì–´ì•¼ í•˜ëŠ”ë° ë‹¤ë¥¸ ìƒ‰ìœ¼ë¡œ ë‚˜ì˜´
- **ì›ì¸**: í”„ë¡¬í”„íŠ¸ì— ìƒ¤í”„íŠ¸ ìƒ‰ìƒ ì§€ì‹œê°€ ì—†ìŒ
- **í˜„ì¬ ì½”ë“œ**: "The driver shaft can remain unchanged if visible" - ìƒ¤í”„íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë¼ëŠ” ì§€ì‹œë§Œ ìˆìŒ

### 3. ìƒ¤í”„íŠ¸/ë°°ì§€ íŒŒì¼ ëˆ„ë½
- **ë¬¸ì œ**: `originals/products/secret-force-pro-3/composition` í´ë”ì— ìƒ¤í”„íŠ¸ì™€ ë°°ì§€ íŒŒì¼ì´ ì—†ìŒ
- **ì›ì¸**: 
  - ìƒ¤í”„íŠ¸/ë°°ì§€ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì´ ì—†ìŒ
  - í´ë” êµ¬ì¡°ì— ìƒ¤í”„íŠ¸/ë°°ì§€ ì €ì¥ ìœ„ì¹˜ê°€ ëª…ì‹œë˜ì§€ ì•ŠìŒ

## ğŸ¯ ê°œì„  ëª©í‘œ

1. **ìƒ¤í”„íŠ¸ ìƒ‰ìƒ ëª…ì‹œ**: í”„ë¡¬í”„íŠ¸ì— ê²€ì •ìƒ‰ ìƒ¤í”„íŠ¸ ì§€ì‹œ ì¶”ê°€
2. **ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ ì°¸ì¡°**: ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ë¥¼ ì°¸ì¡° ì´ë¯¸ì§€ë¡œ ì œê³µ
3. **ë°°ì§€ ì´ë¯¸ì§€ ì°¸ì¡°**: ë°°ì§€ ì´ë¯¸ì§€ë¥¼ ì°¸ì¡° ì´ë¯¸ì§€ë¡œ ì œê³µ
4. **ìƒ¤í”„íŠ¸/ë°°ì§€ íŒŒì¼ ì—…ë¡œë“œ**: ì œí’ˆ í•©ì„± ê´€ë¦¬ì—ì„œ ìƒ¤í”„íŠ¸/ë°°ì§€ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ ì¶”ê°€
5. **í´ë” êµ¬ì¡° ëª…í™•í™”**: composition í´ë” ë‚´ ìƒ¤í”„íŠ¸/ë°°ì§€ íŒŒì¼ ì €ì¥ ìœ„ì¹˜ ì •ì˜

## ğŸ“ ê°œì„  ê³„íš

### 1. í”„ë¡¬í”„íŠ¸ ê°œì„  (lib/product-composition.ts)

#### 1.1 ìƒ¤í”„íŠ¸ ìƒ‰ìƒ ëª…ì‹œ
```typescript
// í˜„ì¬ (301ë²ˆ ë¼ì¸):
prompt += ` Maintain natural shadows and reflections that match the original lighting. The driver shaft can remain unchanged if visible. The replacement should be seamless and realistic, with the new driver head appearing as if it was originally part of the image.`;

// ê°œì„ :
prompt += ` Maintain natural shadows and reflections that match the original lighting. 

CRITICAL SHAFT COLOR INSTRUCTION:
- The driver shaft must be BLACK (matte black or dark graphite black)
- Do NOT change the shaft to any other color (no silver, gold, red, blue, or any other colors)
- The shaft should maintain its original position and angle
- If the shaft is visible, it must remain BLACK throughout its entire length
- The shaft color should match professional golf club standards: matte black graphite shaft

BADGE INSTRUCTION:
- If the product has a badge or logo on the head, ensure it matches the reference images exactly
- The badge position, size, and design must be accurate
- Do NOT add or remove badges that are not in the reference images`;
```

#### 1.2 ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ ì°¸ì¡° ì¶”ê°€
```typescript
// generateCompositionPrompt í•¨ìˆ˜ì— íŒŒë¼ë¯¸í„° ì¶”ê°€
export function generateCompositionPrompt(
  product: ProductForComposition, 
  useReferenceImages: boolean = false,
  driverPart: DriverPart = 'full',
  backgroundType: 'natural' | 'studio' | 'product-page' = 'natural',
  // âœ… ì¶”ê°€
  shaftImageUrl?: string,  // ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ URL
  badgeImageUrl?: string   // ë°°ì§€ ì´ë¯¸ì§€ URL
): string {
  // ... ê¸°ì¡´ ì½”ë“œ ...
  
  // ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì°¸ì¡° ì§€ì‹œ ì¶”ê°€
  if (shaftImageUrl) {
    prompt += ` 

SHAFT REFERENCE:
- Use the provided shaft reference image to match the exact shaft design, color, and texture
- The shaft must be BLACK (matte black) as shown in the reference image
- Match the shaft's diameter, taper, and any graphics or logos on the shaft
- Ensure the shaft connects seamlessly to the driver head`;
  }
  
  // ë°°ì§€ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì°¸ì¡° ì§€ì‹œ ì¶”ê°€
  if (badgeImageUrl) {
    prompt += ` 

BADGE REFERENCE:
- Use the provided badge reference image to match the exact badge design, position, and color
- The badge must be placed in the exact same position as shown in the reference image
- Match the badge size, shape, and any text or graphics on the badge`;
  }
}
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥

#### 2.1 product_composition í…Œì´ë¸”ì— ìƒ¤í”„íŠ¸/ë°°ì§€ í•„ë“œ ì¶”ê°€
```sql
-- ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ URL
ALTER TABLE product_composition ADD COLUMN IF NOT EXISTS shaft_image_url TEXT;
COMMENT ON COLUMN product_composition.shaft_image_url IS 'ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ URL (originals/products/{slug}/composition/shaft.webp)';

-- ë°°ì§€ ì´ë¯¸ì§€ URL
ALTER TABLE product_composition ADD COLUMN IF NOT EXISTS badge_image_url TEXT;
COMMENT ON COLUMN product_composition.badge_image_url IS 'ë°°ì§€ ì´ë¯¸ì§€ URL (originals/products/{slug}/composition/badge.webp)';

-- ìƒ¤í”„íŠ¸ ë¡œê³  ì´ë¯¸ì§€ URL (ì„ íƒ)
ALTER TABLE product_composition ADD COLUMN IF NOT EXISTS shaft_logo_image_url TEXT;
COMMENT ON COLUMN product_composition.shaft_logo_image_url IS 'ìƒ¤í”„íŠ¸ ë¡œê³  ì´ë¯¸ì§€ URL (originals/products/{slug}/composition/shaft-logo.webp)';
```

### 3. ì œí’ˆ í•©ì„± ê´€ë¦¬ UI ê°œì„ 

#### 3.1 ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„¹ì…˜ ì¶”ê°€
```typescript
// pages/admin/product-composition.tsx

// ìƒíƒœ ì¶”ê°€
const [shaftImageUrl, setShaftImageUrl] = useState<string>('');
const [badgeImageUrl, setBadgeImageUrl] = useState<string>('');
const [shaftLogoImageUrl, setShaftLogoImageUrl] = useState<string>('');

// ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
const handleShaftImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0];
  if (!file || !formData.slug || !formData.category) {
    alert('ì œí’ˆ ì •ë³´(Slug, ì¹´í…Œê³ ë¦¬)ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  const formDataToUpload = new FormData();
  formDataToUpload.append('file', file);
  formDataToUpload.append('productSlug', formData.slug);
  formDataToUpload.append('category', formData.category);
  formDataToUpload.append('imageType', 'composition');
  formDataToUpload.append('preserveFilename', 'true'); // íŒŒì¼ëª… ìœ ì§€
  formDataToUpload.append('customFileName', 'shaft'); // ì»¤ìŠ¤í…€ íŒŒì¼ëª…: shaft.webp

  // ... ì—…ë¡œë“œ ë¡œì§ ...
};

// ë°°ì§€ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
const handleBadgeImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
  // ... ìœ ì‚¬í•œ ë¡œì§ ...
  formDataToUpload.append('customFileName', 'badge'); // ì»¤ìŠ¤í…€ íŒŒì¼ëª…: badge.webp
};
```

#### 3.2 UIì— ìƒ¤í”„íŠ¸/ë°°ì§€ ì—…ë¡œë“œ ì„¹ì…˜ ì¶”ê°€
```tsx
{/* ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ ê´€ë¦¬ */}
<div className="mt-4">
  <label className="block text-sm font-medium text-gray-700 mb-1">
    ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ (ì„ íƒ)
  </label>
  <div className="flex gap-2">
    {shaftImageUrl && (
      <div className="relative w-32 h-32 bg-gray-100 rounded overflow-hidden border-2 border-gray-300">
        <Image src={getAbsoluteImageUrl(shaftImageUrl)} alt="ìƒ¤í”„íŠ¸" fill className="object-contain" />
      </div>
    )}
    <label className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer">
      {shaftImageUrl ? 'ìƒ¤í”„íŠ¸ ë³€ê²½' : 'ìƒ¤í”„íŠ¸ ì—…ë¡œë“œ'}
      <input type="file" accept="image/*" onChange={handleShaftImageUpload} className="hidden" />
    </label>
    {shaftImageUrl && (
      <button onClick={() => setShaftImageUrl('')} className="px-4 py-2 bg-red-600 text-white rounded-lg">
        ì‚­ì œ
      </button>
    )}
  </div>
  <p className="text-xs text-gray-500 mt-1">
    ğŸ’¡ ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ ê¶Œì¥ ì‚¬ì´ì¦ˆ: 2000x2000px ì´ìƒ, íˆ¬ëª… ë°°ê²½ PNG ë˜ëŠ” WebP
  </p>
</div>

{/* ë°°ì§€ ì´ë¯¸ì§€ ê´€ë¦¬ */}
<div className="mt-4">
  <label className="block text-sm font-medium text-gray-700 mb-1">
    ë°°ì§€ ì´ë¯¸ì§€ (ì„ íƒ)
  </label>
  {/* ìœ ì‚¬í•œ UI */}
</div>
```

### 4. í•©ì„± API ê°œì„  (pages/api/compose-product-image.js)

#### 4.1 ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ë¥¼ ì°¸ì¡° ì´ë¯¸ì§€ë¡œ ì¶”ê°€
```javascript
// ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì°¸ì¡° ì´ë¯¸ì§€ì— ì¶”ê°€
if (product.shaft_image_url) {
  const shaftUrl = getAbsoluteProductImageUrl(product.shaft_image_url);
  if (shaftUrl) {
    imageUrls.push(shaftUrl);
    console.log('âœ… ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ ì¶”ê°€:', shaftUrl);
  }
}

// ë°°ì§€ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì°¸ì¡° ì´ë¯¸ì§€ì— ì¶”ê°€
if (product.badge_image_url) {
  const badgeUrl = getAbsoluteProductImageUrl(product.badge_image_url);
  if (badgeUrl) {
    imageUrls.push(badgeUrl);
    console.log('âœ… ë°°ì§€ ì´ë¯¸ì§€ ì¶”ê°€:', badgeUrl);
  }
}

// í”„ë¡¬í”„íŠ¸ ìƒì„± ì‹œ ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ URL ì „ë‹¬
let compositionPrompt = prompt || generateCompositionPrompt(
  product, 
  hasReferenceImages,
  targetDriverPart,
  compositionBackground,
  product.shaft_image_url,  // âœ… ì¶”ê°€
  product.badge_image_url   // âœ… ì¶”ê°€
);
```

### 5. íŒŒì¼ ì—…ë¡œë“œ API ê°œì„ 

#### 5.1 ì»¤ìŠ¤í…€ íŒŒì¼ëª… ì§€ì› ì¶”ê°€
```javascript
// pages/api/admin/upload-product-image.js

const customFileName = fields.customFileName?.[0]; // 'shaft', 'badge' ë“±

if (customFileName) {
  // ì»¤ìŠ¤í…€ íŒŒì¼ëª… ì‚¬ìš©
  webpFileName = `${customFileName}.webp`;
} else if (preserveFilename) {
  // ê¸°ì¡´ ë¡œì§
} else {
  // ê¸°ë³¸ ë¡œì§
}
```

## ğŸ“ í´ë” êµ¬ì¡°

### ìƒ¤í”„íŠ¸/ë°°ì§€ íŒŒì¼ ì €ì¥ ìœ„ì¹˜
```
originals/products/{product-slug}/composition/
â”œâ”€â”€ shaft.webp              # ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ (ê²€ì •ìƒ‰)
â”œâ”€â”€ shaft-logo.webp         # ìƒ¤í”„íŠ¸ ë¡œê³  (ì„ íƒ)
â”œâ”€â”€ badge.webp              # ë°°ì§€ ì´ë¯¸ì§€
â””â”€â”€ [ê¸°íƒ€ ì°¸ì¡° ì´ë¯¸ì§€ë“¤]
```

### íŒŒì¼ëª… ê·œì¹™
- **ìƒ¤í”„íŠ¸**: `shaft.webp` (ê³ ì •)
- **ìƒ¤í”„íŠ¸ ë¡œê³ **: `shaft-logo.webp` (ì„ íƒ)
- **ë°°ì§€**: `badge.webp` (ê³ ì •)

## ğŸ¨ ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ ì‚¬ì–‘

### ê¶Œì¥ ì‚¬ì–‘
- **í¬ê¸°**: 2000x2000px ì´ìƒ (ê³ í•´ìƒë„)
- **í˜•ì‹**: PNG (íˆ¬ëª… ë°°ê²½) ë˜ëŠ” WebP
- **ìƒ‰ìƒ**: ê²€ì •ìƒ‰ (matte black ë˜ëŠ” dark graphite black)
- **ê°ë„**: ì¸¡ë©´ ë·° (side view) ê¶Œì¥
- **ë°°ê²½**: íˆ¬ëª… ë˜ëŠ” ë‹¨ìƒ‰ ë°°ê²½

### ìƒ¤í”„íŠ¸ ë¡œê³  ì‚¬ì–‘
- **í¬ê¸°**: 500x500px ì´ìƒ
- **í˜•ì‹**: PNG (íˆ¬ëª… ë°°ê²½)
- **ìœ„ì¹˜**: ìƒ¤í”„íŠ¸ ì¤‘ê°„ ë˜ëŠ” í•˜ë‹¨ì— ìœ„ì¹˜í•œ ë¡œê³ ë§Œ

## ğŸ”§ êµ¬í˜„ ë‹¨ê³„

### Phase 1: í”„ë¡¬í”„íŠ¸ ê°œì„ 
1. âœ… ìƒ¤í”„íŠ¸ ìƒ‰ìƒ ëª…ì‹œ ì¶”ê°€
2. âœ… ë°°ì§€ ì§€ì‹œ ì¶”ê°€
3. âœ… ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ ì°¸ì¡° íŒŒë¼ë¯¸í„° ì¶”ê°€

### Phase 2: ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥
1. âœ… `product_composition` í…Œì´ë¸”ì— ìƒ¤í”„íŠ¸/ë°°ì§€ í•„ë“œ ì¶”ê°€
2. âœ… ê¸°ì¡´ ì œí’ˆ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

### Phase 3: UI ê°œì„ 
1. âœ… ìƒ¤í”„íŠ¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„¹ì…˜ ì¶”ê°€
2. âœ… ë°°ì§€ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„¹ì…˜ ì¶”ê°€
3. âœ… ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ í‘œì‹œ ë° ì‚­ì œ ê¸°ëŠ¥

### Phase 4: API ê°œì„ 
1. âœ… ì—…ë¡œë“œ APIì— ì»¤ìŠ¤í…€ íŒŒì¼ëª… ì§€ì› ì¶”ê°€
2. âœ… í•©ì„± APIì— ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ ì°¸ì¡° ì¶”ê°€
3. âœ… í”„ë¡¬í”„íŠ¸ ìƒì„± ì‹œ ìƒ¤í”„íŠ¸/ë°°ì§€ URL ì „ë‹¬

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] í”„ë¡¬í”„íŠ¸ì— ìƒ¤í”„íŠ¸ ìƒ‰ìƒ ëª…ì‹œ ì¶”ê°€
- [ ] í”„ë¡¬í”„íŠ¸ì— ë°°ì§€ ì§€ì‹œ ì¶”ê°€
- [ ] ë°ì´í„°ë² ì´ìŠ¤ì— ìƒ¤í”„íŠ¸/ë°°ì§€ í•„ë“œ ì¶”ê°€
- [ ] ì œí’ˆ í•©ì„± ê´€ë¦¬ UIì— ìƒ¤í”„íŠ¸/ë°°ì§€ ì—…ë¡œë“œ ì„¹ì…˜ ì¶”ê°€
- [ ] ì—…ë¡œë“œ APIì— ì»¤ìŠ¤í…€ íŒŒì¼ëª… ì§€ì› ì¶”ê°€
- [ ] í•©ì„± APIì— ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ ì°¸ì¡° ì¶”ê°€
- [ ] ìƒ¤í”„íŠ¸/ë°°ì§€ ì´ë¯¸ì§€ ì‚¬ì–‘ ë¬¸ì„œí™”
