# 고객 이미지 분류 시스템 개선 계획

## 현재 상황 분석

### 현재 구조
1. **"업로드된 이미지" 통합 카테고리**
   - 일반 사진, 스캔 서류, 동영상이 모두 함께 표시됨
   - "업로드된 이미지 (12개)" 형태로 통합 표시

2. **보기 모드**
   - 날짜별: 방문일자 기준으로 그룹화
   - 타입별: `image_type` 기준으로 그룹화 (현재는 대부분 null)
   - 전체: 모든 이미지 통합 표시

3. **필터 기능**
   - 방문일자 필터
   - "스캔 서류만 보기" 체크박스 (현재 구현됨)
   - 문서 타입 필터 (주문사양서, 설문조사, 동의서, 기타)

### 문제점
1. **혼재된 콘텐츠 타입**
   - 일반 사진과 스캔 서류가 같은 "업로드된 이미지" 섹션에 표시
   - 사용자가 원하는 콘텐츠를 찾기 어려움

2. **타입별 분류의 한계**
   - `image_type` 필드가 대부분 null이거나 비어있음
   - 실제로 타입별 분류가 제대로 작동하지 않음

3. **"스캔 서류만 보기" 기능의 필요성**
   - 현재 구현되어 있지만, 사용 빈도와 필요성 검증 필요
   - 스캔 서류가 많지 않다면 필터보다는 별도 섹션이 더 나을 수 있음

## 개선 방안

### 옵션 1: 업로드된 이미지와 업로드된 서류 분리 (권장)

**구조**:
```
┌─────────────────────────────────┐
│ 업로드된 이미지 (8개)           │  ← 일반 사진, 동영상
│ └─ 날짜별/타입별/전체 보기      │
│                                 │
│ 업로드된 서류 (4개)             │  ← 스캔 서류만
│ └─ 문서 타입별 필터             │
└─────────────────────────────────┘
```

**장점**:
- 명확한 구분: 이미지와 서류가 자연스럽게 분리됨
- 사용자 경험 향상: 원하는 콘텐츠를 빠르게 찾을 수 있음
- 확장성: 향후 서류 관련 기능 추가 시 용이

**단점**:
- UI 구조 변경 필요
- 기존 사용자 적응 기간 필요

### 옵션 2: 타입별 분류 강화

**구조**:
```
┌─────────────────────────────────┐
│ 업로드된 이미지 (12개)           │
│ └─ 타입별 보기:                  │
│    • 일반 이미지 (8개)           │
│    • 스캔 서류 (4개)             │
│    • 동영상 (0개)                │
└─────────────────────────────────┘
```

**장점**:
- 기존 구조 유지
- 점진적 개선 가능

**단점**:
- `image_type` 필드가 비어있어서 실제 분류가 어려움
- 여전히 혼재된 느낌

### 옵션 3: 하이브리드 방식 (권장 + 타입별)

**구조**:
```
┌─────────────────────────────────┐
│ 📷 업로드된 이미지 (8개)         │
│ └─ 날짜별/타입별/전체 보기       │
│                                 │
│ 📄 업로드된 서류 (4개)           │
│ └─ 문서 타입별 필터              │
│    • 주문사양서 (2개)            │
│    • 설문조사 (1개)              │
│    • 동의서 (0개)                │
│    • 기타 (1개)                  │
└─────────────────────────────────┘
```

**장점**:
- 명확한 구분 + 세부 분류
- 각 섹션별 최적화된 UI 제공 가능
- 사용자 경험 최적화

## 권장 방안: 옵션 3 (하이브리드 방식)

### 이유
1. **명확성**: 이미지와 서류의 구분이 명확함
2. **확장성**: 향후 서류 관련 기능(OCR, 텍스트 추출 등) 추가 시 용이
3. **사용성**: 각 콘텐츠 타입에 맞는 최적화된 UI 제공 가능

## "스캔 서류만 보기" 기능 평가

### 현재 상태
- ✅ 이미 구현되어 있음
- 체크박스로 필터링 가능
- 문서 타입별 추가 필터 제공

### 필요성 분석

**필요한 경우**:
- 스캔 서류가 많고 일반 이미지와 함께 표시될 때
- 특정 문서만 빠르게 찾아야 할 때
- 서류와 이미지를 구분해서 관리할 때

**불필요한 경우**:
- 이미지와 서류가 별도 섹션으로 분리되면 필터가 중복됨
- 서류가 적을 때는 별도 섹션이 더 직관적

### 결론
**이미지와 서류를 분리하면 "스캔 서류만 보기" 필터는 불필요함**
- 서류 섹션 자체가 이미 필터링된 상태
- 대신 서류 섹션 내에서 "문서 타입별 필터"는 유지

## 구현 계획

### 1단계: UI 구조 변경

**파일**: `pages/admin/customers/index.tsx`

**변경 사항**:
1. "업로드된 이미지" 섹션과 "업로드된 서류" 섹션 분리
2. 각 섹션별 독립적인 보기 모드 제공
3. "스캔 서류만 보기" 체크박스 제거 (서류 섹션으로 대체)

**UI 구조**:
```tsx
<div className="space-y-6">
  {/* 업로드된 이미지 섹션 */}
  <div>
    <h3 className="text-lg font-semibold mb-4">
      📷 업로드된 이미지 ({imageCount}개)
    </h3>
    {/* 보기 모드: 날짜별/타입별/전체 */}
    {/* 이미지 그리드 */}
  </div>

  {/* 업로드된 서류 섹션 */}
  <div>
    <h3 className="text-lg font-semibold mb-4">
      📄 업로드된 서류 ({documentCount}개)
    </h3>
    {/* 문서 타입 필터 */}
    {/* 서류 그리드 */}
  </div>
</div>
```

### 2단계: 데이터 필터링 로직 수정

**변경 사항**:
1. 이미지와 서류를 분리하여 조회
2. 각 섹션별 독립적인 필터링 로직

**구현 예시**:
```typescript
// 이미지와 서류 분리
const images = uploadedImages.filter(img => !img.is_scanned_document);
const documents = uploadedImages.filter(img => img.is_scanned_document);

// 이미지 섹션 필터링
const filteredImages = useMemo(() => {
  let filtered = images;
  // 날짜 필터, 타입 필터 등 적용
  return filtered;
}, [images, selectedDateFilter, viewMode]);

// 서류 섹션 필터링
const filteredDocuments = useMemo(() => {
  let filtered = documents;
  // 문서 타입 필터 적용
  if (documentTypeFilter !== 'all') {
    filtered = filtered.filter(doc => doc.document_type === documentTypeFilter);
  }
  return filtered;
}, [documents, documentTypeFilter]);
```

### 3단계: 상태 관리 수정

**변경 사항**:
1. `showScannedDocumentsOnly` 상태 제거 (서류 섹션으로 대체)
2. 각 섹션별 독립적인 상태 관리

**새로운 상태**:
```typescript
// 기존 제거
// const [showScannedDocumentsOnly, setShowScannedDocumentsOnly] = useState(false);

// 이미지 섹션 상태
const [imageViewMode, setImageViewMode] = useState<'date' | 'type' | 'all'>('date');
const [selectedImageDateFilter, setSelectedImageDateFilter] = useState<string | null>(null);

// 서류 섹션 상태
const [documentTypeFilter, setDocumentTypeFilter] = useState<string>('all');
```

### 4단계: UI 컴포넌트 분리

**새로운 컴포넌트**:
1. `CustomerImageSection`: 일반 이미지 섹션
2. `CustomerDocumentSection`: 스캔 서류 섹션

**장점**:
- 코드 가독성 향상
- 각 섹션별 독립적인 관리
- 재사용성 향상

## 상세 구현 계획

### Phase 1: 기본 구조 변경 (1-2시간)

1. **섹션 분리**
   - "업로드된 이미지"와 "업로드된 서류" 섹션 분리
   - 각 섹션별 헤더 추가

2. **필터 제거**
   - "스캔 서류만 보기" 체크박스 제거
   - 서류 섹션 내 문서 타입 필터 유지

3. **데이터 분리**
   - `is_scanned_document` 기준으로 이미지/서류 분리
   - 각 섹션별 카운트 표시

### Phase 2: 보기 모드 개선 (1-2시간)

1. **이미지 섹션 보기 모드**
   - 날짜별: 기존 유지
   - 타입별: `image_type` 또는 파일 확장자 기준
   - 전체: 모든 이미지 통합

2. **서류 섹션 보기 모드**
   - 문서 타입별: 주문사양서, 설문조사, 동의서, 기타
   - 날짜별: 방문일자 기준 (선택적)

### Phase 3: UI/UX 개선 (1시간)

1. **시각적 구분**
   - 섹션별 아이콘 추가 (📷 이미지, 📄 서류)
   - 섹션별 배경색 또는 테두리로 구분

2. **빈 상태 처리**
   - 이미지가 없을 때: "이미지가 없습니다"
   - 서류가 없을 때: "스캔 서류가 없습니다"

3. **반응형 디자인**
   - 모바일에서도 섹션 구분이 명확하도록

## 마이그레이션 전략

### 기존 데이터
- 기존 데이터는 `is_scanned_document` 필드로 이미 분류되어 있음
- 추가 마이그레이션 불필요

### 사용자 적응
- UI 변경이 크지 않아 적응 기간이 짧을 것으로 예상
- 오히려 더 직관적인 구조로 개선

## 예상 작업 시간

- Phase 1 (기본 구조 변경): 1-2시간
- Phase 2 (보기 모드 개선): 1-2시간
- Phase 3 (UI/UX 개선): 1시간
- **총 예상 시간: 3-5시간**

## 우선순위

**높음**: 사용자 경험 개선에 직접적인 영향을 미치는 변경사항

## 테스트 계획

1. **기능 테스트**
   - 이미지와 서류가 올바르게 분리되는지 확인
   - 각 섹션별 필터가 정상 작동하는지 확인
   - 빈 상태 처리 확인

2. **UI 테스트**
   - 섹션 구분이 명확한지 확인
   - 반응형 디자인 확인
   - 접근성 확인

3. **성능 테스트**
   - 대량의 이미지/서류에서도 빠르게 로드되는지 확인

## 파일 목록

### 수정할 파일
1. `pages/admin/customers/index.tsx` - 메인 UI 구조 변경
2. `pages/api/admin/upload-customer-image.js` - 필요시 API 응답 구조 조정

### 새로 생성할 파일 (선택)
1. `components/admin/customers/CustomerImageSection.tsx` - 이미지 섹션 컴포넌트
2. `components/admin/customers/CustomerDocumentSection.tsx` - 서류 섹션 컴포넌트

## 결론

**권장 사항**:
1. ✅ **이미지와 서류를 별도 섹션으로 분리** (옵션 3)
2. ✅ **"스캔 서류만 보기" 필터 제거** (서류 섹션으로 대체)
3. ✅ **각 섹션별 최적화된 보기 모드 제공**

이렇게 하면 사용자가 원하는 콘텐츠를 더 빠르고 직관적으로 찾을 수 있습니다.
