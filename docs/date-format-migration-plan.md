# 날짜 형식 마이그레이션 계획: YYYY.MM.DD → YYYY-MM-DD

## 목적
모든 날짜 형식을 `YYYY-MM-DD` (ISO 8601 표준)로 통일하여:
- 코드 복잡도 감소 (두 가지 형식 지원 불필요)
- 파싱 로직 단순화
- 유지보수성 향상

## 현재 상태

### 데이터베이스
- **file_path**: 점 형식(YYYY.MM.DD) 7개 고유 날짜, 63개 이미지
- **ai_tags**: 이미 대시 형식(YYYY-MM-DD)으로 통일됨 ✅
- **cdn_url**: file_path 기반이므로 함께 업데이트 필요

### Storage
- 실제 폴더명도 점 형식으로 존재
- 마이그레이션 시 폴더 이동 필요

## 마이그레이션 대상

### 날짜별 이미지 수
1. `2024.10.26` → `2024-10-26` (6개 이미지)
2. `2024.09.09` → `2024-09-09` (8개 이미지)
3. `2024.10.15` → `2024-10-15` (12개 이미지)
4. `2024.10.21` → `2024-10-21` (13개 이미지)
5. `2024.10.29` → `2024-10-29` (12개 이미지) ⚠️ **이남구 고객 포함**
6. `2024.10.02` → `2024-10-02` (5개 이미지)
7. `2024.11.13` → `2024-11-13` (7개 이미지)

**총 63개 이미지**

## 마이그레이션 절차

### 1. Storage 폴더 이동
- 각 고객 폴더 내의 날짜 폴더명 변경
- 예: `originals/customers/leenamgu-8768/2024.10.29` → `originals/customers/leenamgu-8768/2024-10-29`
- 폴더 내 모든 파일 이동

### 2. 데이터베이스 업데이트
- `image_assets.file_path`: 점 형식 → 대시 형식
- `image_assets.cdn_url`: file_path 기반으로 재생성

### 3. 코드 정리 (마이그레이션 후)
- 점 형식 지원 코드 제거
- 정규식 단순화: `^\d{4}[.-]\d{2}[.-]\d{2}$` → `^\d{4}-\d{2}-\d{2}$`

## 실행 방법

### DRY RUN (시뮬레이션)
```bash
node scripts/migrate-date-format-dot-to-dash.js
```

### 실제 마이그레이션
```bash
node scripts/migrate-date-format-dot-to-dash.js --execute
```

## 주의사항

⚠️ **이 작업은 되돌릴 수 없습니다!**

1. **백업 권장**: 마이그레이션 전 데이터베이스 백업
2. **Storage 폴더 이동**: 실제 파일이 이동되므로 신중하게 진행
3. **이남구 고객**: `2024.10.29` 날짜가 포함되어 있어 필터 문제 해결에도 도움

## 예상 효과

### 긍정적 효과
- ✅ 코드 단순화 (점 형식 지원 제거)
- ✅ 파싱 로직 단일화
- ✅ 이남구 고객 필터 문제 해결 (폴더명 통일)
- ✅ 유지보수성 향상

### 리스크
- ⚠️ Storage 폴더 이동 중 오류 가능성
- ⚠️ 대량 업데이트로 인한 DB 부하
- ⚠️ 마이그레이션 중 이미지 로딩 실패 가능성

## 검증 방법

마이그레이션 후:
```bash
node scripts/check-date-formats.js
```

점 형식이 0개인지 확인
