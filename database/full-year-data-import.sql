-- ðŸ“… ì—‘ì…€ ê¸°ë°˜ ì „ì²´ 12ê°œì›” ë°ì´í„° ìž…ë ¥ (2025.7 ~ 2026.6)

-- ì›”ë³„ í…Œë§ˆ ì „ì²´ ìž…ë ¥
INSERT INTO monthly_themes (year, month, theme, objective, promotion_detail, target_audience) VALUES
-- 2025ë…„
(2025, 7, 'ì—¬ë¦„ ì„±ìˆ˜ê¸° ì¿¨ë§ ìº íŽ˜ì¸', 
 'ëœ¨ê±°ìš´ ì—¬ë¦„, ì™„ë²½í•œ ìŠ¤ìœ™ì„ ìœ„í•œ ì¤€ë¹„', 
 'ìƒë‹´/ë°©ë¬¸ ê³ ê° ì „ì²´ ì¿¨ë§ íŒ¨í‚¤ì§€(ìŠ¤í¬ì¸  íƒ€ì›”, íŒ”í† ì‹œ) ì¦ì • + êµ¬ë§¤ ê³ ê° ê³ ê¸‰ ìœ„ìŠ¤í‚¤ ì¦ì •',
 'ê³ ì†Œë“ì¸µ ë° 4060ì„¸ëŒ€'),

(2025, 8, 'ì—¬ë¦„ íœ´ê°€ ì‹œì¦Œ', 
 'íœ´ê°€ì² , ê³¨í”„ íœ´ì–‘ì§€ í•„ìˆ˜í’ˆ', 
 '00ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ê³¨í”„ ì—¬í–‰ ìƒí’ˆê¶Œ 00ë§Œì› ì¦ì • + ë°©ìˆ˜íŒŒìš°ì¹˜ ì¦ì •',
 'íœ´ê°€ì²  ê³¨í”„ ì—¬í–‰ê°'),

(2025, 9, 'ê°€ì„ ì‹œì¦Œ ì¤€ë¹„', 
 'ê°€ì„ ë¼ìš´ë“œ, ìŠ¤íƒ€ì¼ë¦¬ì‹œí•˜ê²Œ / ê³¨í”„ ì„±ìˆ˜ê¸° ì „ ì ê²€ OR êµì²´', 
 '00ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ê³¨í”„ ì˜ë¥˜ ìƒí’ˆê¶Œ 00ë§Œì› ì¦ì • + ë§ˆì“°êµ¬ ë¡œê³  ë³¼ìº¡ ì¦ì •',
 'ê°€ì„ ê³¨í”„ ì‹œì¦Œ ê³ ê°'),

(2025, 10, 'ê°€ì„ ê³¨í”„ ì„±ìˆ˜ê¸°', 
 'ê°€ì„ ê³¨í”„, ë§ˆì“°êµ¬ë¡œ ì™„ì„±', 
 'ì ì • í• ì¸ 00% ì œê³µ + ê³¨í”„ ìž¥ê°‘ ì¦ì •',
 'ê³ ì†Œë“ì¸µ'),

(2025, 11, 'ë¸”ëž™ í”„ë¼ì´ë°ì´ ì„¸ì¼', 
 'ë¸”ëž™ í”„ë¼ì´ë°ì´, ë§ˆì“°ê³¨í”„ íŠ¹ë³„ ì„¸ì¼', 
 'ì—°ì¤‘ ìµœëŒ€ í• ì¸ 00% ì œê³µ',
 'ì „ì²´ ê³ ê°'),

(2025, 12, 'ì—°ë§ ê³ ê° ê°ì‚¬', 
 'ì—°ë§, ë§ˆì“°êµ¬ì™€ í•¨ê»˜í•œ ê³¨í”„ì˜ ì¶”ì–µ', 
 '00ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ë§ˆì“°êµ¬ êµ¿ì¦ˆ(ì•…ì„¸ì„œë¦¬) ì¦ì •',
 'ì¶©ì„± ê³ ê°'),

-- 2026ë…„
(2026, 1, 'ìƒˆí•´ ë‹¤ì§ê³¼ ê³¨í”„ ì‹œìž‘', 
 '2025ë…„, ìƒˆí•´ ì²« ìŠ¤ìœ™ì„ ë§ˆì“°êµ¬ì™€', 
 '00ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ê³¨í”„ê³µ, ë³¼ë§ˆì»¤, ë¹„ê±°ë¦¬ ì¸¡ì •ê¸° ì¦ì • + ì‹ ë…„ ëŸ­í‚¤ ë“œë¡œìš° ì¶”ì²¨ ì´ë²¤íŠ¸(1ë“±: ê³¨í”„ë°±, 2ë“±: ooo)',
 'ì‹ ê·œ ê³ ê°'),

(2026, 2, 'ì„¤ë‚  ì„ ë¬¼ ìº íŽ˜ì¸', 
 'ì„¤ë‚ , ê³¨í”„ ì„ ë¬¼ë¡œ ë§ˆìŒì„ ì „í•˜ì„¸ìš”', 
 'ì„¤ ì„ ë¬¼ íŒ¨í‚¤ì§€ 00% í• ì¸ + ëª…ì ˆ ì „ìš© ì„ ë¬¼ í¬ìž¥',
 'ì„¤ ì„ ë¬¼ êµ¬ë§¤ ê³ ê°'),

(2026, 3, 'ë´„ ë§žì´ ì¤€ë¹„', 
 'ë´„ ê³¨í”„ ì‹œì¦Œ, ë§ˆì“°êµ¬ë¡œ ì¤€ë¹„ ì™„ë£Œ', 
 'ì ì • í• ì¸ 00% ì œê³µ + ê³¨í”„ ìž¥ê°‘ ì¦ì •',
 'ì‹œì¦Œ ì¤€ë¹„ ê³ ê°'),

(2026, 4, 'ê³¨í”„ ì‹œì¦Œ ë³¸ê²© ê°œë§‰', 
 'ë³¸ê²© ê³¨í”„ ì‹œì¦Œ, ë§ˆì“°êµ¬ì™€ í•¨ê»˜', 
 '00ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ê³¨í”„ ì˜ë¥˜ ìƒí’ˆê¶Œ 00ë§Œì› ì¦ì • + ë§ˆì“°êµ¬ ë¡œê³  ë³¼ìº¡ ì¦ì •',
 'ì‹ ê·œ ë° ê¸°ì¡´ ê³ ê°'),

(2026, 5, 'ê°€ì •ì˜ ë‹¬ ì„ ë¬¼ ìº íŽ˜ì¸', 
 'ê°€ì¡±ê³¼ í•¨ê»˜í•˜ëŠ” ê³¨í”„ ì„ ë¬¼', 
 '00ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ê³¨í”„ oooo ì¦ì • + ê³ ê¸‰ ê³¨í”„ ìš°ì‚° ì¦ì •',
 'ê°€ì¡± ë‹¨ìœ„ ê³ ê°'),

(2026, 6, 'ì´ˆì—¬ë¦„ ì¤€ë¹„', 
 'ì—¬ë¦„ ê³¨í”„ë¥¼ ìœ„í•œ í•„ìˆ˜ ì¤€ë¹„', 
 '00ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ê³ ê¸‰ ìŠ¤í¬ì¸  ì„ ê¸€ë¼ìŠ¤ ì¦ì •',
 'ì—¬ë¦„ ì¤€ë¹„ ê³ ê°')
ON CONFLICT (year, month) DO UPDATE SET
  theme = EXCLUDED.theme,
  objective = EXCLUDED.objective,
  promotion_detail = EXCLUDED.promotion_detail,
  target_audience = EXCLUDED.target_audience;

-- ê° ì›”ë³„ ìº íŽ˜ì¸ ìžë™ ìƒì„± (ì¹´ì¹´ì˜¤í†¡, ë¬¸ìž)
DO $$
DECLARE
    v_theme RECORD;
    v_date DATE;
BEGIN
    FOR v_theme IN 
        SELECT * FROM monthly_themes 
        WHERE (year = 2025 AND month >= 7) OR (year = 2026 AND month <= 6)
        ORDER BY year, month
    LOOP
        v_date := DATE(v_theme.year || '-' || LPAD(v_theme.month::TEXT, 2, '0') || '-01');
        
        -- ì¹´ì¹´ì˜¤í†¡ (1ì¼, 15ì¼)
        INSERT INTO marketing_campaigns (date, month, year, channel, topic, content, target_count, assignee, status)
        VALUES 
        (v_date, v_theme.month, v_theme.year, 'kakao', v_theme.theme, 
         v_theme.objective || ' - ì¹´ì¹´ì˜¤í†¡ 1ì°¨', 1200, 'ì œì´', 'planned'),
        (v_date + 14, v_theme.month, v_theme.year, 'kakao', v_theme.theme, 
         SUBSTRING(v_theme.promotion_detail, 1, 50) || '... ì¹´ì¹´ì˜¤í†¡ 2ì°¨', 1200, 'ì œì´', 'planned')
        ON CONFLICT DO NOTHING;
        
        -- ë¬¸ìž (2ì¼, 16ì¼)
        INSERT INTO marketing_campaigns (date, month, year, channel, topic, content, target_count, assignee, status)
        VALUES 
        (v_date + 1, v_theme.month, v_theme.year, 'sms', v_theme.theme, 
         'ê³ ê°ë‹˜! ' || v_theme.month || 'ì›” íŠ¹ë³„ í˜œíƒ ì•ˆë‚´', 1200, 'ì œì´', 'planned'),
        (v_date + 15, v_theme.month, v_theme.year, 'sms', v_theme.theme, 
         SUBSTRING(v_theme.promotion_detail, 1, 40) || '...', 1200, 'ì œì´', 'planned')
        ON CONFLICT DO NOTHING;
        
        -- ë¸”ë¡œê·¸ ëŒ€í‘œ (7ì¼)
        INSERT INTO marketing_campaigns (date, month, year, channel, topic, content, target_count, assignee, status)
        VALUES 
        (v_date + 6, v_theme.month, v_theme.year, 'blog', v_theme.theme, 
         'ë¸”ë¡œê·¸: ' || v_theme.objective, 0, 'ìŠ¤í…Œí”¼', 'planned')
        ON CONFLICT DO NOTHING;
        
        -- ë©€í‹°ì±„ë„ ì½˜í…ì¸  ìƒì„±
        PERFORM generate_monthly_content(v_theme.year, v_theme.month);
    END LOOP;
END $$;

-- ê²°ê³¼ í™•ì¸
SELECT 
    year,
    month,
    theme,
    (SELECT COUNT(*) FROM marketing_campaigns mc WHERE mc.year = mt.year AND mc.month = mt.month) as campaigns,
    (SELECT COUNT(*) FROM content_ideas ci 
     WHERE EXTRACT(YEAR FROM ci.scheduled_date) = mt.year 
     AND EXTRACT(MONTH FROM ci.scheduled_date) = mt.month) as contents
FROM monthly_themes mt
WHERE (year = 2025 AND month >= 7) OR (year = 2026 AND month <= 6)
ORDER BY year, month;